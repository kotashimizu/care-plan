# 実装計画

- [x] 1. プロジェクト初期設定とコア構造の構築
  - Next.js 15.4.3プロジェクトの作成とTypeScript設定
  - Tailwind CSS、shadcn/ui、必要な依存関係のインストール
  - 基本的なディレクトリ構造とファイル構成の作成
  - _要件: 1.1, 6.1_

- [x] 2. データ型定義とインターフェースの実装
  - 個別支援計画書の型定義（IndividualSupportPlan, SupportGoal等）
  - 事業所設定の型定義（FacilitySettings）
  - API リクエスト・レスポンスの型定義
  - _要件: 1.1, 3.1_

- [x] 3. メインレイアウトとページ構造の実装
  - レスポンシブ対応のルートレイアウト（app/layout.tsx）
  - ホームページの基本構造（app/page.tsx）
  - ヘッダー、フッターコンポーネントの作成
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [x] 4. 事業所設定パネルコンポーネントの実装
  - 事業所種別選択UI（FacilitySettingsPanel.tsx）
  - 作業内容、事業所特色、利用者特性の選択フォーム
  - 設定値の状態管理とバリデーション
  - _要件: 3.1, 3.2, 3.3, 3.4_

- [x] 5. 面談記録入力コンポーネントの実装
  - テキストエリアコンポーネント（InterviewRecordInput.tsx）
  - 入力内容のリアルタイムバリデーション
  - 生成ボタンとローディング状態の管理
  - _要件: 1.1, 7.4_

- [x] 6. AI APIプロンプト生成システムの実装
  - **✅ Phase1完了** 障害者総合支援法対応の最適化プロンプト作成
  - 事業所設定に応じたプロンプトカスタマイゼーション機能
  - 利用者特性（障害種別、年齢層）に応じた動的プロンプト生成
  - **504エラー対策**: 200行→10行→80行の段階的最適化実施
  - _要件: 3.4, 1.2_

- [x] 7. 計画書生成APIエンドポイントの実装
  - **✅ Node.js Runtime**として /api/generate-plan の実装（Edge→Node.js変更）
  - OpenAI API統合とエラーハンドリング
  - レスポンス形式の標準化とデータ変換
  - **✅ 504エラー対策完了**: タイムアウト35s、max_tokens2200
  - **✅ JSON解析エラー対策**: コンテンツクリーニング機能実装
  - _要件: 1.2, 7.1, 7.2, 7.5_

- [x] 8. 計画書表示コンポーネントの実装
  - 生成結果の構造化表示（SupportPlanDisplay.tsx）
  - 各項目の個別表示とフォーマット
  - 項目別コピー機能とクリップボード操作
  - _要件: 1.3, 4.1, 4.2, 4.3, 4.4_

- [ ] 9. 品質チェック機能の実装
  - 品質スコア計算と表示（QualityCheck.tsx）
  - 品質チェックAPI（/api/quality-check）の実装
  - 改善提案生成機能
  - _要件: 5.1, 5.2, 5.3_

- [ ] 10. 代替案生成機能の実装
  - 3つの代替案生成API（/api/generate-alternatives）
  - 代替案表示コンポーネント（AlternativePlans.tsx）
  - 就労重視型、生活重視型、社会参加重視型の切り替え表示
  - _要件: 5.4_

- [ ] 11. エラーハンドリングとユーザーフィードバックの実装
  - API エラー、ネットワークエラーの適切な処理
  - ユーザーフレンドリーなエラーメッセージ表示
  - 再試行機能と待機時間表示
  - _要件: 7.1, 7.2, 7.3, 7.4_

- [ ] 12. セキュリティ機能の実装
  - データ非保存の確実な実装（メモリ内処理のみ）
  - ページリロード時のデータクリア機能
  - 入力データのサニタイゼーション
  - _要件: 2.1, 2.2, 2.3, 2.4_

- [ ] 13. レスポンシブデザインの最適化
  - デスクトップ、タブレット、スマートフォン対応の調整
  - タッチ操作に適したUI要素の実装
  - 動的レイアウト調整の実装
  - _要件: 6.1, 6.2, 6.3, 6.4_

- [ ] 14. パフォーマンス最適化の実装
  - コンポーネントの遅延読み込み設定
  - API呼び出しの最適化
  - ローディング状態とプログレスインジケーターの実装
  - _要件: 1.2_

- [ ] 15. 単体テストの実装
  - 主要コンポーネントのテストケース作成
  - API関数のテスト実装
  - プロンプト生成ロジックのテスト
  - _要件: 全要件の品質保証_

- [ ] 16. 統合テストの実装
  - API呼び出しフローのテスト
  - エラーハンドリングのテスト
  - レスポンシブデザインのテスト
  - _要件: 全要件の統合確認_

- [x] 17. Vercelデプロイ設定の実装
  - **✅ 504エラー対策** vercel.json設定ファイルの作成（maxDuration: 60s）
  - 環境変数の設定
  - **Node.js Runtime**への変更（Edge Functions制限回避）
  - _要件: 全要件のプロダクション対応_

- [ ] 18. テキスト編集機能の実装
  - React ContentEditableまたは類似ライブラリの導入
  - EditableSupportPlanコンポーネントの作成
  - 編集モード切り替え機能の実装
  - 編集内容の保存・キャンセル機能
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ] 19. PDF出力機能の実装
  - @react-pdf/rendererライブラリの導入
  - PDFExportコンポーネントの作成
  - A4サイズでの印刷適応レイアウト設計
  - 事業所情報、作成日時、ページ番号の追加
  - 自動ダウンロード機能の実装
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ] 20. E2Eテストとプロダクション検証
  - 完全な計画書生成フローのテスト
  - 編集・PDF出力機能のテスト
  - 異なるデバイスでの動作確認
  - セキュリティ要件の最終検証
  - _要件: 全要件の最終確認_