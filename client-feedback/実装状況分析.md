# 実装状況分析レポート

## 作成日: 2025年1月19日

## 現在の実装状況

### ✅ 既に実装済みの機能

1. **本人の役割欄（userRole）**
   - `SupportGoal`型に`userRole: string`として定義済み
   - 各支援目標（就労・日常生活・社会生活）に実装済み
   - プロンプトでは「本人の役割を含む留意事項」として記載

2. **基本的な支援計画構造**
   - 到達目標（objective）
   - 支援内容（supportContent）
   - 支援期間（achievementPeriod）
   - 担当者（provider）
   - 優先度（priority）

### ⚠️ 改善が必要な箇所

#### 1. 文言・表現の調整

**到達目標（objective）の文言**
- 現在: 支援者視点の表現
  ```
  「就労能力向上の具体的で測定可能な目標を80文字程度で設定」
  ```
- 必要: 本人視点の表現
  ```
  「本人が希望する内容を『〜したい』形式で80文字程度で記載」
  ```

**支援内容（supportContent）の文言**
- 現在: 中立的な表現
  ```
  「支援内容・提供上のポイントを記載」
  ```
- 必要: 支援者視点の能動的表現
  ```
  「支援者が行う支援を『〜を行います』『〜を支援します』形式で記載」
  ```

#### 2. データ形式の変更

**優先度（priority）の形式**
- 現在: `"高・中・低"` の文字列
- 必要: `"1", "2", "3"` の数字文字列

### 🔧 新規開発が必要な機能

#### サービス等利用計画書との連携機能

**必要な要素:**
1. 入力フィールドの追加
   - 相談支援専門員が作成した計画書の情報入力欄
   - または、既存データのインポート機能

2. データ構造の拡張
   ```typescript
   interface ServiceUsagePlan {
     userIntentions: string;        // 利用者の意向
     familyIntentions: string;      // 家族の意向
     comprehensivePolicy: string;   // 総合的な支援方針
     priorityService: string;       // 優先サービス
   }
   ```

3. UIコンポーネントの追加
   - サービス等利用計画書入力パネル
   - 計画書連携設定画面

## プロンプト修正箇所の詳細

### ファイル: `src/lib/prompts-improved.ts`

**修正が必要な行番号と内容:**

- **121行目** (就労支援の到達目標)
- **130行目** (日常生活支援の到達目標)  
- **139行目** (社会生活支援の到達目標)
  - 変更: 本人視点の願望形式に

- **122行目** (就労支援の支援内容)
- **131行目** (日常生活支援の支援内容)
- **140行目** (社会生活支援の支援内容)
  - 変更: 支援者の能動的な行動として記載

- **126行目** (就労支援の優先度)
- **135行目** (日常生活支援の優先度)
- **144行目** (社会生活支援の優先度)
  - 変更: 「1, 2, 3」の数字形式に

## 推奨実装順序

### フェーズ1: 即座に対応可能（プロンプト調整）
1. 到達目標の文言を本人視点に変更
2. 支援内容の文言を支援者視点に変更
3. 優先度を数字表記に変更

### フェーズ2: 軽微な開発（型定義・表示調整）
1. 優先度の型を調整（必要に応じて）
2. 表示コンポーネントの微調整

### フェーズ3: 新機能開発
1. サービス等利用計画書の入力インターフェース
2. データ連携機能の実装
3. 統合テスト

## 影響範囲

### 変更の影響を受けるコンポーネント
- `EditableSupportPlan.tsx` - 編集時の表示
- `SupportPlanDisplay.tsx` - 閲覧時の表示
- `SelectedPlanPDFView.tsx` - PDF出力
- API生成ロジック - プロンプトによる生成結果

### バックワード互換性
- 既存データとの互換性維持が必要
- 優先度の形式変更時は変換処理が必要